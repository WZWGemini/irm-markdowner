# 定义 image
image: node:10.15.0

# 定义 stages
stages:
  - install_build_deploy

# 设置缓存
# ps: 只有一个 job 就不用设置缓存了
# cache:
#   key: ${CI_COMMIT_REF_NAME}
#   paths:
#     - node_modules/
#     - md/

# before_script:
# ps: 提供一种思路
#   - PATH=/usr/local/node/bin:$PATH
#   - export PATH
#   - whoami
#   - pwd
#   - echo $PATH

before_script:
  - echo "Starting job_install"
  - ls -al
  - ls -al src/views
  - node -v
  - npm -v
  - npm install

# 定义 job
job_install_build_deploy:
  stage: install_build_deploy
  # when: manual
  script:
    - echo "Starting job_build"
    - npm run build
    - echo "Starting deploy"
    - rm -rf /var/data/sword/md
    - copy md/ /var/data/sword
